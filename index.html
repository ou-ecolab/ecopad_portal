<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <!--
    Note that the following links refer to directories provided by the
    cybercommons package. We could however replace them
    -->
    <link
      rel="stylesheet"
      type="text/css"
      href="/static/rest_framework/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="/static/rest_framework/css/bootstrap-tweaks.css"
    />

    <link
      rel="stylesheet"
      type="text/css"
      href="/static/rest_framework/css/prettify.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="/static/rest_framework/css/default.css"
    />
    <script src="/static/rest_framework/js/jquery-3.5.1.min.js"> </script>
    <script src="/static/rest_framework/js/bootstrap.min.js"></script>
    <script src="/static/rest_framework/js/prettify-min.js"></script>
<!--
-->
</head>
<body class="">
  <div
    class="navbar navbar-static-top navbar-inverse"
    role="navigation"
    aria-label="navbar"
  >
    <div class="container">
      <span>
        <a class="navbar-brand" rel=" nofollow" href="#" >EcoPAD
          <span class="version" style="margin-left: 5px">
            2.0
          </span>
        </p >
      </span>
      <span>
        <a class="navbar-brand" rel=" nofollow" href="/" >Cybercommons Base 
        </a >
      </span>
      <span>
        <a class="navbar-brand" rel=" nofollow" href="/api/" >Api
        </a >
      </span>
      <ul class="nav navbar-nav pull-right" id="user"> 
      </ul>
      </div>
    </div>

<script>
  //const base_url = "/ecopad_portal/index.html";
  const base_url = window.location.pathname 
  function show_login(ul){
    ul.innerHTML=`
    <li>
      <a id="login" href="/api/api-auth/login/?next=${base_url}">Log in</a>
    </li>`
  }
  
  function show_logout(ul){
    ul.innerHTML=`
      <li id=user class="dropdown">
        <a  href="#" class="dropdown-toggle" data-toggle="dropdown">
          ecopad
          <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a href="/api/api-auth/logout/?next=">Log out</a></li>
        </ul>
      </li>
    `
  }
  
  $(function () {
    // this is the jQuery abbreviation for the function that is called at the 
    // document.ready event and is executed as soon as the document is fully loaded
    // 
    user_url = "/api"+ "/user.json/";
    console.log(user_url);
    // If we are logged in the following user_url will be available at the server
    // (in the background django will check if the session cockie it sent us earlier
    // which will be integrated by the browser into all our subsequent requests
    // authorizes us to visit this url but the only thing we have to know is that
    // the following ajax request will only succeed if we are logged in.
  	ul=document.getElementById("user")
    $.getJSON(user_url, function (data) {
      console.log("success");
      console.log(data.username);
      show_logout(ul);
    }).fail(function () {
      console.log('fail')
      show_login(ul)
    });
  });
  
</script>
</body>
</html>

